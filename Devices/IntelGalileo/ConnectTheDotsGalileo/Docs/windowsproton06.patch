From 7008b571348d5116c4b2a4491a7fd0d66306fc98 Mon Sep 17 00:00:00 2001
From: ivanignatiev <ignatiev.ivan@gmail.com>
Date: Mon, 26 Jan 2015 11:37:58 +0100
Subject: [PATCH] Enable Windows build

---
 proton-c/src/codec/data.h |  1 +
 proton-c/src/platform.h   | 15 +++++++++++++++
 2 files changed, 16 insertions(+)

diff --git a/proton-c/src/codec/data.h b/proton-c/src/codec/data.h
index 5ac8d45..da7be63 100644
--- a/proton-c/src/codec/data.h
+++ b/proton-c/src/codec/data.h
@@ -41,6 +41,7 @@ typedef struct {
   size_t data_offset;
   size_t data_size;
   char *start;
+  #undef small
   bool small;
 } pni_node_t;
 
diff --git a/proton-c/src/platform.h b/proton-c/src/platform.h
index a9ae580..da2f78c 100644
--- a/proton-c/src/platform.h
+++ b/proton-c/src/platform.h
@@ -88,6 +88,21 @@ int pn_i_vsnprintf(char *buf, size_t count, const char *fmt, va_list ap);
  * Provide function/macro definition
  */
 #define va_copy(d,s) ((d) = (s))
+
+#include <Windows.h> 
+#include <Wincrypt.h> 
+#define strncasecmp _strnicmp 
+#define strcasecmp _stricmp 
+#define strncasecmp _strnicmp 
+#define strcasecmp _stricmp 
+ 
+// From http://linux.die.net/include/bits/stat.h 
+#define    __S_IFMT    0170000    /* These bits determine file type.  */ 
+#define    __S_IFDIR    0040000    /* Directory.  */ 
+// From http://linux.die.net/include/sys/stat.h 
+#define    __S_ISTYPE(mode, mask)    (((mode) & __S_IFMT) == (mask)) 
+#define    S_ISDIR(mode)     __S_ISTYPE((mode), __S_IFDIR) 
+
 #endif
 
 
-- 
1.9.5.msysgit.0

